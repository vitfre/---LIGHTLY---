/*
 * LD.c
 *
 * Created: 11.04.2014 19:33:24
 *  Author: Администратор
 */ 

#include "main.h"

//****************************************************************************************
// Timer0 overflow interrupt service routine
//****************************************************************************************
ISR (TIMER0_OVF_vect)
{
	//---------------------------------------------------------------------------------------
	// Reinitialize Timer 0 value
	TCNT0=0x84;
	//---------------------------------------------------------------------------------------
	BUT_Debrief();
	SENS_Debrief();
	//---------------------------------------------------------------------------------------
	return;
};
//****************************************************************************************
// Timer1 overflow interrupt service routine
//****************************************************************************************
ISR (TIMER1_OVF_vect)
{
	//---------------------------------------------------------------------------------------
	// Reinitialize Timer1 value
	TCNT1H=0x0B;
	TCNT1L=0xDC;
	//---------------------------------------------------------------------------------------
	return;
};

int main(void)
{
	unsigned char item_sell = 0x01;
	//---------------------------------------------------------------------------------------
	init_mcu();					// Запускаємо всяку периферію.
	BUT_Init();					// Ініціалізація кнопок
	SENS_Init();				// Ініціалізація датчиків
	BUZZ_LD_INIT
	//---------------------------------------------------------------------------------------
	all_ok(0x03);				// Запалили світлодіоди
	//---------------------------------------------------------------------------------------
	init_LCD();					// Ініціалізація LCD
	uart_1_init();				// Ініціалізація UART
	//Global enable interrupts
	sei();
	//---------------------------------------------------------------------------------------
	beep_tone(50);				// Пікнули
	//---------------------------------------------------------------------------------------
	Main_menu (item_sell, active_sensors);	// Обновили LCD
	//---------------------------------------------------------------------------------------
	_delay_ms(50);
	//---------------------------------------------------------------------------------------
	beep_tone(50);				// Пікнули
	//---------------------------------------------------------------------------------------
	all_ok(0x00);				// Погасили світлодіоди
	//---------------------------------------------------------------------------------------
    while(1)
    {
		//---------------------------------------------------------------------------------------
		if (GET_trig())		// Перевіряємо чи датчики спрацьовували
		{
			//---------------------------------------------------------------------------------------
			all_ok(0x02);							// Запалили червоний світлодіод
			//---------------------------------------------------------------------------------------
			Main_menu (item_sell, active_sensors);// Обновили LCD
			beep_tone(0x05);						// Пікнули
			//---------------------------------------------------------------------------------------
			all_ok(0x00);							// Погасили світлодіоди
			//---------------------------------------------------------------------------------------
		};
		//---------------------------------------------------------------------------------------
		switch (BUT_GetKey())		// Читаємо буфер клавіатури і переходим на відповідний case в залежності від коду кнопки
		{
			case 0x00 :
			{
				//---------------------------------------------------------------------------------------
				
				//---------------------------------------------------------------------------------------
			};
			break;
			case 0x01 :
			{
				//---------------------------------------------------------------------------------------
				beep_tone(5);			// Пікнули
				item_sell--;			// Крок вверх по списку
				if (item_sell<=1)		// якщо дійшли до кінця то зупиняємся
				{
					item_sell=1;
					beep_tone(40);		// Пікнули
				};
				Main_menu (item_sell, active_sensors);// Обновили LCD
				//---------------------------------------------------------------------------------------
			};
			break;
			case 0x02 :
			{
				//---------------------------------------------------------------------------------------
				
				//---------------------------------------------------------------------------------------
			};
			break;
			case 0x03 :
			{
				//---------------------------------------------------------------------------------------
				beep_tone(5);			// Пікнули
				item_sell++;			// Крок вниз по списку
				if (item_sell>=18)	// якщо дійшли до кінця то зупиняємся
				{
					item_sell=18;
					beep_tone(40);		// Пікнули
				};
				Main_menu (item_sell, active_sensors);// Обновили LCD
				//---------------------------------------------------------------------------------------
			};
			break;
			case 0x04 :
			{
				//---------------------------------------------------------------------------------------
				
				//---------------------------------------------------------------------------------------
			};
			break;
			case 0x05 :
			{
				//---------------------------------------------------------------------------------------
				all_ok(0x01);				// Запалили жовтий світлодіод
				beep_tone(50);				// Пікнули
				for (unsigned char i=0;i<=17;i++)	// у даному циклі обнуляємо лічильники спрацювань
				{
					active_sensors[i]=0;
				};
				Main_menu (item_sell, active_sensors);// Обновили LCD
				all_ok(0x00);				// Погасили світлодіоди
				//---------------------------------------------------------------------------------------
			};
			break;
			default :;
		};   //switch (BUT_GetKey())
		//---------------------------------------------------------------------------------------
	};
};